<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}

</style>

   


<head>
<link rel="stylesheet" type="text/css" href="bootstrap.css">
<script type="text/javascript" src="jquery.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="bootstrap.js"></script>
</head>
<body>

<div class="navbar">
    <div class="navbar-inner">
      <a class="brand">Promoter Architecture Browser</a>
      <ul class="nav">
        <li>
          <a href="architectures.html" >Size 3</a>
        </li>
        <li>
          <a href="architectures_4.html">Size 4</a>
        </li>
        <li class="active">
          <a href="architectures_5.html">Size 5</a>
        </li>
      </ul> 
    </div>
</div>

<script>

var width = 1000,
    height = 1000;

var center_x=width/2.0;
var canter_y=height/2.0;

var bb_switch=[0, 1];
var bb_cluster=[Math.sqrt(3)/2.0, -0.5];
var bb_barrier=[-Math.sqrt(3)/2.0, -0.5];

$.getJSON("networkjson_middle2_5", function(data){



var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var str=90;



var parents = {};
data.forEach( function(d) { 

  if(! (d.parent in parents) ){
     parents[d.parent] = [];
  }
  parents[d.parent].push(d);
});


cols=["#fff999", "#ff9999", "#ff99ff", "#99ccff", "#66cc99", "#ccff66"];



var color = d3.scale.ordinal().range(["#909090", "#c0c0c0", "#e8e8e8"]);
  //    .range(["#fff999", "#ff9999", "#ff99ff", "#99ccff", "#66cc99", "#ccff66"]);
//    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

//["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]


var pie = d3.layout.pie()
    .sort(null)
    .value(function(d_1) { return d_1.count; });


Object.keys(parents).forEach(function(d){

     //radius
     sum=0;
     parents[d].forEach( function(i){ sum=sum+i.count; })

     if(sum>2){
     radius= 8*Math.sqrt(sum); 

    arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(0);
 
     //cx
     par=parseInt(d);
     bar=par%10;
     swi=(par%100-bar)/10;
     clu=(par%1000-bar-swi*10)/100;                                                  
     cx=center_x+str*bb_barrier[0]*bar+str*bb_cluster[0]*clu;

     //cy
     par=parseInt(d);
     cy=center_x+str*bb_switch[1]*swi+str*bb_barrier[1]*bar+str*bb_cluster[1]*clu;

     //draw pie chart

     parents[d].forEach(function(d_1) {
         d_1.count = +d_1.count;
     });

  var g = svg.selectAll(".arc"+d)
      .data(pie(parents[d]))
      .enter().append("g")
      .attr("class", "arc")
      .attr("transform", "translate(" + cx + "," + cy + ")");

  g.append("path")
      .attr("d", arc)
      .style("fill", function(d_1, i) { return color(i); });

  g.append("text")
      .attr("transform", function(d_1, i) { 
        if(parents[d][i].id=="111"){
          return "translate(-1, 2)";
        }
        if(parents[d][i].id=="333"){
          return "translate(-1, 2)";
        }
        if(parents[d][i].id=="222"){
          return "translate(-1, 2)";
        }
        if(parents[d][i].id=="3112"){
          return "translate(-8, 40)";
        }
        if(parents[d][i].id=="2332"){
          return "translate(15, -50)";
       }
        if(parents[d][i].id=="2121"){
          return "translate(20, 40)";
        }
        return "translate(" + arc.centroid(d_1) + ")"; })
      .attr("font-size", 12)
      .style("text-anchor", "middle")
      .on("click", function(d_1,i) {
            d3.select(this).attr("transform", "translate(20, 40)" )})
      .text(function(d_1, i) { 
        
        return ""+parents[d][i].count; });

   }

  });
});


</script>